C     X,Y,SUBJECT  REFORMATTING PROGRAM--FORTRAN 77
C        BY SOL KATZ   BLM   DSC   JULY 1986
C
      CHARACTER*40 INFILE
      CHARACTER*1  NEGFLAG
      CHARACTER*1  ANSWER
      CHARACTER*60 FORMATE
      CHARACTER*30 SUBJECT
      CHARACTER*132 INSTRING
      logical fok
      integer*2 ixyz(5)
      DOUBLE PRECISION X,Y
C
      do 11,i=1,40
        infile(1:i) = ' '
11    continue
      ixyz(1) = 2hxy
      ixyz(2) = 2hz.
      ixyz(3) = 2him
      ixyz(4) = 0
      ixyz(1) = 1hp
C
      IN=23
      IMP=24
      PRINT *, 'WELCOME TO THE X,Y,SUBJECT REFORMATING PROGRAM'
      PRINT *
C
      PRINT *, 'WHAT IS THE NAME OF THE X,Y,SUBJECT DATA FILE?  '
      READ  (*,901) INFILE
901   FORMAT (A20)
C
      if(infile(1:1).ne.' ')then
      PRINT *,' '
      PRINT *, INFILE //' IS THE INPUT FILE'
      PRINT *,' '
      IF (INFILE(8:8).EQ.' '.AND. INFILE(1:7) .EQ. 'XYZ.IMP') THEN
         PRINT *, INFILE,' IS A NAME OF THIS PROGRAMS OUTPUT FILE '
         PRINT *,  'YOU MUST RENAME THE INPUT FILE AND START OVER.'
         STOP
      END IF
      else
      stop '   '
      endif
      OPEN (IN,FILE=INFILE,ERR=750,IOSTAT=IER,STATUS='OLD')
C     PRINT *, ' '
906   PRINT *, 'ARE THE COORDINATES IN'
      PRINT *, ' 1) DECIMAL DEGREES'
      PRINT *, ' 2) METERS OR FEET'
      PRINT *, 'ENTER 1 OR 2    '
      READ(*,910)ANSWER
910   FORMAT(A1)
      IF (ANSWER .EQ. '1' .OR. ANSWER .EQ.'2') THEN
        CONTINUE
      ELSE
        PRINT *, 'ANSWER MUST BE 1 OR 2'
        GOTO 906
      ENDIF
C
      IF (ANSWER .EQ.'1') THEN
        PRINT *, 'ENTER  Y  IF LONGITUDES IN THE WESTERN HEMISPHERE',
     +           '(USA) ARE NEGATIVE?  '
        READ(*,911) NEGFLAG
911     FORMAT(A1)
          IF (NEGFLAG .EQ. 'Y') THEN
            FACTOR =  1
          ELSE
            FACTOR = -1
          ENDIF
      ENDIF
C
1011  PRINT *
      PRINT *, 'WHAT IS THE FORMAT OF THE X,Y,SUBJECT DATA FILE?  '
      PRINT *, 'FIRST VALUE IS X, SECOND IS Y, SUBJECT IS THIRD'
      PRINT *, 'X AND Y COORDINATES USE F FORMAT, EG. F10.2, F8.4'
      PRINT *, 'SUBJECT USES A# FORMAT, EG. A30, A8'
      PRINT *, 'USE TABS TO INDICATE STARTING POSITION IN DATA FILE,',
     +         'EG. T10, T33'
      PRINT *, 'ENCLOSE THE ENTIRE FORMAT STATEMENT IN PARENTHESIS,',
     +         'EG.'
      PRINT *, '     (T30,F9.3,T10,F8.2,T50,A10) '
      PRINT *, 'IN THIS EXAMPLE, THE X COORDINATE STARTS IN THE 30th',
     +         ' POSITION, USES 9 '
      PRINT *, 'SPACES, AND 3 OF THOSE SPACES ARE TO THE RIGHT OF ',
     +         'THE DECIMAL.'
      PRINT *, 'THE Y COORDINATE STARTS IN THE 10th POSITION, USES 9 ',
     +         'SPACES, AND 2 OF THOSE '
      PRINT *, 'ARE TO THE RIGHT OF THE DECIMAL.'
      PRINT *, 'THE SUBJECT STARTS IN THE 50th POSITION, AND USES 10',
     +         ' SPACES.'
      PRINT *, ' '
      PRINT *, '         1         2         3         4         5',
     +         '         6         7        '
      PRINT *, '12345678901234567890123456789012345678901234567890',
     +         '1234567890123456789012345678'
      READ (IN,915) INSTRING
      PRINT *, INSTRING
      PRINT *, 'WHAT IS THE FORMAT OF THE X,Y,SUBJECT DATA FILE?  '
      FOK = .FALSE.
      READ  (*,909) FORMATE
      DO 1012 IX = 2 , 59
         IF ( FORMATE(IX:IX) .EQ. 'a' .OR. FORMATE(IX:IX) .EQ. 'A')
     .      FOK = .TRUE.
1012  CONTINUE
      IF (.NOT. FOK ) THEN
         PRINT *, ' *** SUBJECT MUST BE "A" FORMAT ***'
         GOTO  1011
         ENDIF
      PRINT *,' '
      PRINT *,'THE FORMAT IS ',FORMATE
      PRINT *,' '
909   FORMAT (A60)
      CLOSE (IN)
C
      OPEN (IN,FILE=INFILE,ERR=750,IOSTAT=IER,STATUS='OLD')
c     +      PAD='YES')
C      call dfilw(ixyz,ier)
      OPEN (IMP,FILE='XYZ.IMP',STATUS='UNKNOWN')
C
      LINE=1
      KOUNT=0
C
C     LOOP UNTIL EOF
 100  READ (IN ,FORMATE,END=600,ERR=700) X,Y,SUBJECT
      KOUNT=KOUNT+1
      IF (ANSWER .EQ. '1')  THEN
        WRITE (IMP,904)KOUNT*(-1),SUBJECT
904     FORMAT (I5,T16,A30  ,T55,'1')
        WRITE (IMP,912)X*FACTOR,Y
912     FORMAT(2F10.5,' 0')
      ELSE
        WRITE (IMP,904)KOUNT,SUBJECT
        WRITE(IMP,908)X,Y
908     FORMAT (2F11.2 )
      ENDIF
C
C     GET NEXT RECORD
      GOTO 100
C
600   PRINT *, 'XYZ.IMP          IS THE IMPORT FILE'
      PRINT *, ' '
      PRINT *, 'USE THE PC-MOSS IMPORT COMMAND TO CREATE A POINT MAP.'
      PRINT *, 'THERE ARE ',KOUNT, ' ITEMS IN THE FILE'
C
      STOP ' NORMAL END OF PROGRAM'
700   PRINT *, ' SOME SORT OF READ INPUT FILE ERROR HAS OCCURED '
      print *, '   AT LINE # ',KOUNT+LINE
      LINE =LINE +1
      BACKSPACE IN
      READ (IN,915) INSTRING
      PRINT *, INSTRING
915   FORMAT(A132)
      GOTO 100
750   PRINT *, 'ERROR ON OPENING INPUT FILE    IER= ',IER
c      PRINT *, 'ENTER     MESSAGE/D  ',IER,'     TO FIND THE PROBLEM'
      STOP
C
      END
