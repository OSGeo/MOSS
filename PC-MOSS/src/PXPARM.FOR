      SUBROUTINE PXPARM(ITABLE,LINES,IDTYPE,LABEL,
     1                  DISMAX,OUTPROX,DESCMAP,IER)
C
$Include:'whmap.inc'
$Include:'io.inc'
$Include:'strng.inc'
C
      INTEGER DESCMAP(30)
      INTEGER TABLE(1),MACTS,LINES,ITYPE,LABEL(1),ICOM(10)
C
      REAL DISMAX
C
      LOGICAL MCOMP,OUTPROX
C
C**********************************************************************
C
C  NAME:    S U B R O U T I N E    P X P A R M
C
C  PURPOSE: THIS ROUTINE GETS USER INPUT FOR THE PROXIMITY COMMAND
C
C  PARAMETERS:
C       NAME    USE     TYPE    DIMENSION   DESCRIPTION
C       ------  ------  ------  ---------   ---------------------------
C
C      ITABLE    OUT     INT      DYN       ACTIVE MAP I.D.'S
C
C      MACTS     OUT     INT V    1         NUMBER ACTIVE MAP I.D.'S
C
C      LINES     OUT     INT      1         IO COUNT
C
C      IDTYPE    OUT     INT      1         ONE MAP OR TWO MAP PROXIM.
C
C      LABEL     OUT     INT      DYN       RETURNED NEW MAP NAME
C
C      DISMAX    OUT     REAL     1         SEARCH DISTANCE
C
C      OUTPROX    OUT     LOG      1        OUT OF PROX FLAG
C
C      DESCMAP   OUT     INT ARRAY 30       DESCRIPTION OF MAP
C
C      IER       OUT     INT      1         ERROR RETURN
C
C  FILES:
C       UNIT    FILE NAME OR DESCRIPTION
C       ------  -------------------------------------------------------
C
C**********************************************************************
C
C
      IER=0
      LINES=1
      IPROMT=0
C
C  GET ACTIVE MAP I.D.'S
C
      CALL DAGET(ICARD,icardp,ITABLE,40,MACTS)
      IF(MACTS.NE.0) GO TO 10
C
C  PROMPT FOR ACTIVE MAP I.D.'S
C
  5   IPROMT=1
      WRITE(NPRNT,1000)
 1000 FORMAT(' ENTER ACTIVE MAP I.D.(S) TO PROXIMITY '\)
      CALL READIN(ICARD,lenicd,icardp,istop)
      CALL DAGET(ICARD,icardp,ITABLE,40,MACTS)
      LINES=LINES+3
C
C  DETERMINE PROXIMITY ANALYSIS TYPE
C
  10  CONTINUE
      IF(MACTS.LE.0) GO TO 800
      IF(MACTS.EQ.1) IDTYPE=1
      IF(MACTS.EQ.2) IDTYPE=2
      IF(MACTS.GT.2) GO TO 801
C
C  GET MAP NAME
C
      IF(IPROMT.EQ.1) GO TO 11
C
      CALL DECIP(ICARD,LABEL,icardp)
      IF(LABEL(1).NE.0) GO TO 13
C
  11  CONTINUE
      CALL WHTCAL(LABEL,ier)
      IPROMT=1
C
  13  CONTINUE
      CALL MCHEK(LABEL,IFIL,NENTS,I,IER)
      IF(IFIL.EQ.0) GO TO 14
C
      LINES=LINES+2
      WRITE(NPRNT,2028)
 2028 FORMAT(' THIS MAP NAME ALREADY EXISTS.  TRY AGAIN')
      GO TO 11
C
  14  CONTINUE
C
C  GET SEARCH DISTANCE
C
      IF(IPROMT.EQ.1) GO TO 15
      CALL FNUM(ICARD,80,DISMAX,icardp)
      CALL CHKUNTS(ICARD,icardp,IUNITS,DISMAX)
      IF(DISMAX.NE.0.0) GO TO 20
C
C  PROMPT FOR MAX DISTANCE
C
  15  CONTINUE
      IPROMT=1
      WRITE(NPRNT,1001)
 1001 FORMAT(' ENTER MAXIMUM SEARCH DISTANCE (WITH UNITS) '\)
      CALL READIN(ICARD,lenicd,icardp,istop)
      CALL FNUM(ICARD,80,DISMAX,icardp)
      CALL CHKUNTS(ICARD,icardp,IUNITS,DISMAX)
      LINES=LINES+3
  20  CONTINUE
      IF(IUNITS.LT.0) GO TO 9000
C
C  DETERMINE IF TO KEEP CLOSE OR FAR AWAY
C
  30  CONTINUE
      IF(IPROMT.EQ.1) GO TO 40
C
      CALL DECIP(ICARD,ICOM,icardp)
      IF(ICOM(1).NE.0) GO TO 50
C
C  PROMPT FOR CLOSE OR FAR KEEP
C
  40  CONTINUE
      IPROMT=1
      WRITE(NPRNT,1040)
1040  FORMAT(' DO YOU WISH OBJECTS OUT OF PROXIMITY? [NO] '\)
      CALL READIN(ICARD,lenicd,icardp,istop)
      CALL DECIP(ICARD,ICOM,icardp)
      LINES=LINES+3
C
C  GET PARAMETER AND INTERPRET
C
  50  CONTINUE
      OUTPROX=.FALSE.
      IF(MCOMP(ICOM(1),'Y',1,IER)) OUTPROX=.TRUE.

C
C  GET MAP DESCRIPTION
C
      CALL FILLC(DESCMAP,30,' ')
      IF(IPROMT.EQ.1) GO TO 60
      IF(ICARD(icardp+1).EQ.0) GO TO 60
      icardp=icardp+1
      CALL PACKC(ICARD(icardp),DESCMAP,30)
      GO TO 70
C
C  PROMPT FOR DESCRIPTION
C
  60  CONTINUE
      WRITE(NPRNT,1060)
 1060 FORMAT(' PLEASE ENTER 60 CHARACTER OR LESS MAP DESCRIPTION')
      WRITE(NPRNT,1065)
 1065 FORMAT
     1 ('  -----------------------------------------------------------')
      CALL READIN(ICARD,lenicd,icardp,istop)
      CALL PACKC(ICARD(1),DESCMAP,30)
C
  70  CONTINUE
C      CALL BACKUP(ICARD,icardp)
C      CALL PAD(DESCMAP(1),30)
C
      IER=0
C
      RETURN
9000  IER=-1
      RETURN
 800  write(*,*)' No data to process - You must use <SELECT>'
      IER=-1
      RETURN
 801  WRITE(NPRNT,3010)
 3010 FORMAT(' MUST ENTER EITHER ONE OR TWO ACTIVE MAP I.D S')
      LINES=LINES+2
C
      IER=-1
      RETURN
      END
