C *******************************************************************
C
C             P R O G R A M    S T A T U S
C FUNCTION:
C             PRINT OUT STATUS INFORMATION ON EITHER THE DATABASE
C             OR AN INDIVIDUAL MAP
C *******************************************************************
C
$Include:'DNAMES.inc'
$Include:'STRNG.inc'
        COMMON /IDEVIC/ LDEVL(128)
        COMMON /FLS/    IUNIT,IFILE(5)
        COMMON /PNTFET/ NPOINT
        COMMON /WHMAP/  ISTRCT(300),NSTRCT
        COMMON /IO/     NPRNT,IOIN
        COMMON /WORK/   IBUFF(128),MAP(25),ICOM(10),JCOM(10)
        integer mapname(25)
        REAL NPTS
c        CHARACTER SCOLOR*21
        LOGICAL SCOMP,MCOMP
C
        call initl(ier)
        if(ier.ne.0)stop
C
C  SET CURSOR COUNTER
C
        LINES=1
C
C  GET ACTION
C
        CALL DECIP(ICARD,ICOM,icardp)
C
C ACTION SPECIFIED ?
C
        IF(ICOM(1).NE.0) GO TO 10
C
C  NO. PROMPT USER
C
        WRITE(NPRNT,1000)
 1000   FORMAT(' ENTER: DATABASE, JOB, OR A <MAPNAME>'\)
        CALL READIN(ICARD,lenicd,icardp,istop)
        CALL DECIP(ICARD,ICOM,icardp)
        LINES=LINES+3
C
C  GOT ACTION.  CHECK ITS TYPE
C
  10    CONTINUE
        IF(MCOMP(ICOM,'DATA',4,IER)) GO TO 100
        IF(MCOMP(ICOM,'JOB',3,IER)) GO TO 200
C
C  ACTION IS ON AN INDIVIDUAL MAP. CHECK FOR ITS EXISTENCE
C
        CALL MCHEK(ICOM,IFIL,NENTS,ITYP,IER)
        IF (IFIL .NE. 0) GO TO 35
C
C  NAME NOT FOUND.  TELL USER AND ABORT
C
  30    CONTINUE
        WRITE(NPRNT,1001)
 1001   FORMAT(' THIS MAP DOES NOT EXIST')
        LINES=LINES+2
        GO TO 500
C
C  MAP FOUND.  WRITE OUT ITS NAME
C
 35     CONTINUE
        CALL GTNAM(-1,0,ICOM,MAP,IER)
        if(ifil.eq.1)then
          map(1)=(-map(1))
          call adddir(map,mapname)
        else
          call adddir(map,mapname)
        endif
        WRITE(NPRNT,1002) (MAPname(I),I=1,12)
 1002   FORMAT(' INFORMATION FOR MAP ',12a2)
C
C  TYPE OUT ITS STATUS
C
C        IF(NENTS.GT.0) WRITE(NPRNT,1003)
c 1003   FORMAT(' STATUS OF MAP        = ON DISK')
c        IF(NENTS.LT.0) WRITE(NPRNT,1004)
c 1004   FORMAT(' STATUS OF MAP        = ARCHIVED ON TAPE')
        WRITE(NPRNT,1005) ITYP
 1005   FORMAT(' DATA TYPE            =',I5)
C
C  PRINT OUT NUMBER OF ENTRIES FOR THIS MAP IF VECTOR
C
        IF (ITYP .GE. 6  .AND.  ITYP .LE. 9) GO TO 500
        ITEMS=IABS(NENTS)
        WRITE(NPRNT,1011) ITEMS
 1011   FORMAT(' NUMBER OF ITEMS      =',I5)
C
C  DETERMINE NUMBER OF COORDINATE PAIRS
C
        CALL OPENF(10,MAPname,1,256,2,IER)
        IF(IER.NE.0) GO TO 902
        CALL RDBLK(10,1,IBUFF,1,IER)
c        IF (IBUFF(127) .EQ. 0) THEN
c          SCOLOR='(NO COLOR ASSIGNMENT)'
c        ELSEIF (IBUFF(127) .EQ. 1) THEN
c          SCOLOR='(WHITE)'
c        ELSEIF (IBUFF(127) .EQ. 2) THEN
c          SCOLOR='(BLUE)'
c        ELSEIF (IBUFF(127) .EQ. 3) THEN
c          SCOLOR='(YELLOW)'
c        ELSEIF (IBUFF(127) .EQ. 4) THEN
c          SCOLOR='(GREEN)'
c        ELSEIF (IBUFF(127) .EQ. 5) THEN
c          SCOLOR='(RED)'
c        ELSEIF (IBUFF(127) .EQ. 6) THEN
c          SCOLOR='(CYAN)'
c        ELSEIF (IBUFF(127) .EQ. 7) THEN
c          SCOLOR='(MAGENTA)'
c        ELSEIF (IBUFF(127) .EQ. 8) THEN
c          SCOLOR='(BROWN)'
c        ELSEIF (IBUFF(127) .EQ. 9) THEN
c          SCOLOR='(GRAY)'
c        ELSEIF (IBUFF(127) .EQ. 10) THEN
c          SCOLOR='(DARK GREEN)'
c        ELSEIF (IBUFF(127) .EQ. 11) THEN
c          SCOLOR='(LIGHT RED)'
c        ELSEIF (IBUFF(127) .EQ. 12) THEN
c          SCOLOR='(LIGHT CYAN)'
c        ELSEIF (IBUFF(127) .EQ. 13) THEN
c          SCOLOR='(LIGHT MAGENTA)'
c        ELSEIF (IBUFF(127) .EQ. 14) THEN
c          SCOLOR='(DARK BLUE)'
c        ELSE 
c          SCOLOR='(DARK GRAY)'
c        ENDIF
c        WRITE(NPRNT,1022) IBUFF(127),SCOLOR
c1022    FORMAT(' CURRENT COLOR ASSIGNMENT  = ',I2,' ',a25)
        NREC=IBUFF(64)+IBUFF(65)+2
        NPTS=0.0
        DO 40 I=1,NENTS
        CALL RDBLK(10,NREC,IBUFF,1,IER)
        NREC=IBUFF(1)
        NPTS=NPTS+IBUFF(25)
  40    CONTINUE
        WRITE(NPRNT,1010) NPTS
 1010   FORMAT(' NUMBER OF COORDINATES ',F10.0)
        LINES=LINES+6
        CLOSE(10,iostat=IER)
        GO TO 500
C
C  STATUS ON ENTIRE DATABASE
C
 100    CONTINUE
C
C  PRINT OUT NUMBER OF MAPS IN DATABASE
C
        IBUFF(16) = 1
        IF (MAST(1) .NE. 0) CALL GETMAP(1,1,IBUFF,IER)
        IP3 =IBUFF(16)-1
        CALL GETMAP(2,1,IBUFF,IER)
        ITP3 =IBUFF(16)-1
        WRITE(NPRNT,1012) IP3,(MAST(I),I=1,25),ITP3,(IWORK(I),I=1,12)
 1012   FORMAT(1X,I5,' MAPS IN MASTER PROJECT ',25a1,/,
     1         1X,I5,' MAPS IN WORK PROJECT   ',12a1)
        LINES =LINES+3
 500    CONTINUE
        GO TO 90000
C
C  JOB STATUS
C
 200  CONTINUE
      WRITE(NPRNT,1020)
 1020 FORMAT(/' CURRENT PC-MOSS RUNTIME STATUS INFORMATION '/)
      LINES=LINES+3
      CALL WHWND(VX1,VY1,VX2,VY2)
      NA=NSTRCT/7
      WRITE(NPRNT,1021) NA,NPOINT,(MAST(I),I=1,25)
 1021 FORMAT(' CURRENT NUMBER OF ACTIVE MAPS    = ',I5,
     1      /' CURRENT NO. OF ENTRIES IN POINT  = ',I5,
C     2      /' CURRENT DISPLAY DEVICE           = ',5A2,
     3      /' CURRENT MASTER PROJECT           = ',25a1)
      WRITE(NPRNT,1023) VX1,VY1,VX2,VY2
 1023 FORMAT(' CURRENT DISPLAY WINDOW           = ',
     1      /'   MININUM X VALUE (WEST BORDER)  = ',F10.1,
     2      /'   MININUM Y VALUE (SOUTH BORDER) = ',F10.1,
     3      /'   MAXIMUM X VALUE (EAST BORDER)  = ',F10.1,
     4      /'   MAXIMUM Y VALUE (NORTH BORDER) = ',F10.1,/)
      LINES=LINES+10
C      IF(LDEVL(1).EQ.0) GO TO 90000
C      WRITE(NPRNT,1027) (LDEVL(I),I=1,5),(LDEVL(I),I=7,10)
C 1027 FORMAT(/'   CURRENT COLOR DEVICE          = ',5A2,
C     1       /'   NUMBER OF SCAN LINES          = ',I5,
C     2       /'   NUMBER PIXELS/SCAN LINE       = ',I5,
C     3       /'   PALLET SIZE                   = ',I5,
C     4       /'   MAXIMUM NO. OF COLORS AT ONCE = ',I5,/)
C      LINES=LINES+6
      GO TO 90000
C
C  ERROR RETURNS
C
 902    WRITE(NPRNT,3002) (MAP(I),I=1,10),IER
 3002   FORMAT(' *STATUS*  ERROR OPENING ',10A2,'  ERROR',I5)
        LINES=LINES+2
C
90000   continue
        END
