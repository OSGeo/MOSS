C*****************************************************************************
C
C  FILE:  S U B R O U T I N E   P L O T P
C
C  PLOT THE CONTENTS OF AN ENTRY POLYGON ON THE CALCOMP
C
C  INPUT PARAMETERS
C
C        ICHAN=DATA CHANNEL
C        INDEX=POLYGON #
C        IBUFF=ARRAY HOLDING POLYGON RECORD
C        WIND1=MINIMUM X OF THE POLYGON
C        WIND3=MINIMUM Y OF THE POLYGON
C
C
C*****************************************************************************
C
      SUBROUTINE PLOTP(ICHAN,INDEX,IBUFF,WIND1,WIND3,ICHAN2)
C      COMMON /CHANL/   IO(40)
      COMMON /BLMSYMC/ SYMANG,SHITE,SWIDE
C      COMMON /RBR/     IRBGR,ICHR
C      COMMON /RBS/     IRBGS,ICHS
$include:'xypnts.inc'
      COMMON /PDASHP/  DASHV
      COMMON /LEGAL/   ISHADE,IDASH,ROT,D,MOSAIC,LPEN,LDASH,
     +                 LSTYPE,WIDTHL,DMARK
      COMMON /DIMEN/   X1,X2,Y1,Y2,XLN,YLN,SCALE,FACT,X0,Y0
      COMMON /PENS/    ILPEN,IPPEN,ISPEN,IAPEN
      COMMON /ROTATE/  THETAD,TURN,SCAL
      DIMENSION        ISH(2),ISW(2)
C      INTEGER          BYTE
      EQUIVALENCE      (ISH,SHITE),(ISW,SWIDE)
      DIMENSION        IBUFF(128),ISLAND(400),LABL(15)
      LOGICAL          TURN
      DATA             SMVAL / .00001 /
C
C  GET ISLAND INFO & LOAD INTO ISLAND
C
      IDTYP=IBUFF(6)
      ITEMNO=IBUFF(5)
      ISUBP=IBUFF(24)
C/* SUBJECT POINTER
      ISLAND(1)=0
      CALL Igetis(IBUFF,ISLAND,NSLAND,ICHAN,INDEX)
C
C  GET COORDINATE DATA
C
      IF(NSLAND.GE.100) CALL RDBLK(ICHAN,INDEX,IBUFF,128,IER)
      CALL CORDXY(IBUFF,NPTS,INDEX,WIND1,WIND3,ICHAN)
C
C  NPTS IS THE NUMBER OF X,Y POINTS IN THE POLYGON ENTRY
C
C  NOW ENTER THE PLOT SEQUENCE
C
      IF(IDTYP.EQ.2) GO TO 50
C/*  LINE DATA
C**     CALCULATE OFFSET & CONVER METERS TO INCHES @ SCALE
      CALL CPTRNS(X(1),XC,X1,SCALE)
      CALL CPTRNS(Y(1),YC,Y1,SCALE)
      IF (NPTS .EQ. 1) GO TO 40
C/*  SYMBOL DATA
      CALL PLOTW(XC,YC,3)
C
C       PLOT THE POINTS IN THIS SET OF DATA.
C
      IF(IPPEN.EQ.0) GO TO 123
C/*  DON'T PLOT POLYGON BORDERS
      CALL NEWPEN(IPPEN)
      IPOINT=1
      ISLAND(NSLAND+1)=0
      DO 20 I=2,NPTS
        call spoints('X ',x,xd,i,1)
        call spoints('Y ',y,yd,i,1)
c        XD=X(I)
c        YD=Y(I)
        CALL CPTRNS(XD,XC,X1,SCALE)
        CALL CPTRNS(YD,YC,Y1,SCALE)
        IF (I .NE. ISLAND(IPOINT)) GO TO 10
        CALL PLOTW(XC,YC,3) 
C/*  LIFT PEN UP FOR ISLAND
        IPOINT=IPOINT+1
        GO TO 20
 10     IF(LDASH.EQ.0) CALL PLOTW(XC,YC,2)
        IF(LDASH.EQ.1) CALL DASHP(XC,YC,DASHV)
 20   CONTINUE
C
C     ALL POINTS IN THIS DATA SET (X,Y,I=1,NPTS) HAVE BEEN PLOTTED.
C
123   CALL PLOTA(ICHAN,ICHAN2,NPTS)
C/*  PLOT SUBJECT
      IF(ISHADE.EQ.ICHAR('N')) RETURN
C/*  NO SHADING
C       NOW SHADE THIS POLYGON, IF REQUESTED TO DO SO.
C
      CALL NEWPEN(ILPEN)
C/*  CHANGE PEN FOR SHADING
      CALL croshach(NPTS,ABS(ROT),D,NSLAND,ISLAND,
     +            LSTYPE,WIDTHL,DMARK,ILPEN,ISPEN)
      IF(ROT.LT.0.) CALL croshach(NPTS,ABS(ROT)+90.,D,NSLAND,ISLAND,
     +                          LSTYPE,WIDTHL,DMARK,ILPEN,ISPEN)
      RETURN
C**    PEN UP TO X,Y & PLOT SINGLE CENTERED 'X'
40    CONTINUE
      CALL RDBLK(ICHAN,INDEX,IBUFF,128,IER)
      CALL NEWPEN(ISPEN)
C/*  USE SHADE PEN TYPE AS SYMBOL PEN TYPE
      IF(LSTYPE.NE.-1) GO TO 42
C/* ALREADY DEFINED HITE,WIDTH,ANGLE
        SYMANG=IBUFF(28)
        ISH(1)=IBUFF(29)
        ISH(2)=IBUFF(30)
        ISW(1)=IBUFF(31)
        ISW(2)=IBUFF(32)
 42   LST=LSTYPE
      IF(LST.EQ.-1) LST=IBUFF(27)
C/* GET ADS SYMBOL
      IF(LST.EQ. 0) LST=8
C/* DEFAULT IS 'X'
      IF(LST.EQ.99) GO TO 45
C/* NO SYMBOL
        IF(ABS(SHITE).LT.SMVAL) SHITE=.15
        IF(ABS(SWIDE).LT.SMVAL) SWIDE=.15
        CALL BLMSYM(XC,YC,SHITE,SWIDE,SYMANG,LST,ISPEN,ISPEN)
 45   TURN=.FALSE.
      CALL PLOTA(ICHAN,ICHAN2,1)
C/*  PLOT SUBJECT
      TURN=.TRUE.
      RETURN
C
C  SPECIAL LINE TYPES
C
  50  CONTINUE
      IF(LSTYPE.EQ.-1) GO TO 55
C/*  CONTOUR PLOT
        TURN=.FALSE.
        CALL PLOTA(ICHAN,ICHAN2,NPTS)
C/*  PLOT SUBJECT
        TURN=.TRUE.
        IF(LSTYPE.EQ.0) RETURN
C/*  INVISIBLE LINE REQUESTED
 55   CALL NEWPEN(ILPEN)
C          MAKE SURE ALL POINTS SEND ARE INSIDE VIEW WINDOW
      DO 60 I=1,NPTS
        CALL CPTRNS(X(I),XC,X1,SCALE)
C/*CONVERT DATA TO PLOTTER INCHES
        CALL CPTRNS(Y(I),YC,Y1,SCALE)
         call spoints('X ',x,xc,i,2)
c        x(i)=xc
C/*  STORE DATA IN ZETA PLOTTER INCHES
          call spoints('Y ',y,yc,i,2)
c         y(i)=yc
  60  CONTINUE
      IF(LSTYPE.EQ.-1)
     +   CALL GETSUB(ICHAN,ISUBP,IBUFF,LABL,ITS)
C/* GET LABEL
      IF(LSTYPE.EQ.-1)
     +   CALL CONTPL(NPTS,LABL,.07)
C/*  CONTOUR PLOT
      IF(LSTYPE.GE.0)
     +   CALL BLMLINE(x,y,NPTS,WIDTHL,DMARK,LSTYPE,ILPEN,ISPEN)
      RETURN
      END

