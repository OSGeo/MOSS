        SUBROUTINE PUTAT
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
CC
CC NAME : SUBROUTINE PUTAT
CC
CC FUNCTION : TO ADD TO AN ASSOCIATED ATTRIBUTES DATA BASE AND/OR TO
CC            CREATE AN ASSOCIATED ATTRIBUTES DATA BASE.
CC
CC ROUTINES
CC CALLED:    REALS,LETERS,RECEIVE,WRBLK,DIGET.
CC
CC FILES : MUST HAVE ACCESS TO FILE MASTER.DT
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
CC
$Include:'IO.inc'
      COMMON /BATAT/ IMAP(25),KMAP(25),BATCH,ICHAN7,ICHAN8
      COMMON/ UNIT / CHANEL, ATRBTE, POLYGON, ADRESS
CC
      DIMENSION ICARD(80)
CC
      INTEGER   CHANEL, ATRBTE, POLYGON, ADRESS, ACTION
      INTEGER   NUMBER, RECORD( 128 ), KEY( 80 )
C
      LOGICAL SCOMP,MCOMP,BATCH
CC
CC
CC
             BATCH=.FALSE.
            ICHAN7=51
            ICHAN8=52
            lenicd=80
            iohold=ioin
C
C  ASK USER IF 'BATCH' RUN
C
      WRITE(NPRNT,1006)
 1006 FORMAT(' IS THIS A BATCH INPUT (Y OR N) '\)
      CALL READIN(ICARD,1,ISTART,istop)
      IF(MCOMP(ICARD(1),'Y',1,IER)) BATCH=.TRUE.
      IF(.NOT.BATCH) GO TO 5
C
C  YUP, BATCH INPUT.  GET INPUT FILES NAMES
C
      WRITE(NPRNT,1007)
 1007 FORMAT(' PLEASE ENTER THE NAME OF THE INPUT DATA FILE '\)
      CALL READIN(IMAP,25,ISTART,ISTOP)
C
C********** TO ALLOW FOR ATTRIBUTE FILES TO BE LONGER THAN 132 CHARS
      IER = 0
      CALL OPENF(ICHAN7,IMAP,1,0,0,IER)
      IF(IER.NE.0) GO TO 900
C
      WRITE(NPRNT,1009)
 1009 FORMAT(' PLEASE ENTER THE NAME OF THE ATTRIBUTE DEFINITION FILE'\)
      CALL READIN(KMAP,25,ISTOP,ISTOP)
      CALL OPENF(ICHAN8,KMAP,1,0,0,IER)
      IF(IER.NE.0) GO TO 910
C
      ioin=ichan8
  5   CONTINUE
10          CONTINUE
            NUMBER = 0
CC

20          CONTINUE
            IF(BATCH) REWIND ICHAN7
CC
CC
CC CREATING THE ATTRIBUTE HEADER.
                  RECORD( 86 ) = ADRESS
                  ATRBTE = ATRBTE + 1
                  RECORD( 1 ) = ATRBTE
CC
                IF(.NOT.BATCH) WRITE(NPRNT,1000)
 1000  FORMAT(' PLEASE TYPE IN THE KEY (10 CHARACTERS OR LESS)'\)
                CALL RECEIVE( KEY, 10 )
                LIMIT = 1
                DO 30 INDEX = 2, 11
CC
                  RECORD( INDEX ) = KEY( LIMIT )
                  LIMIT = LIMIT + 1
CC
30              CONTINUE
CC
CC
                  IF(.NOT.BATCH) WRITE(NPRNT,1001)
 1001 FORMAT(' PLEASE TYPE IN THE DESCRIPTOR (60 CHARACTERS OR LESS)')
                  call clear(icard,80)
                  CALL READIN( ICARD,LENICD,ISTART, ISTOP)
                  INDEX = 12
                  DO 40 J = 1, 60
                   record(index)=32
                   if(icard(j).gt.0)record(index)=icard(j)
                    INDEX = INDEX + 1
40                CONTINUE
C                   
50                CONTINUE
CC
 1002    IF(.NOT.BATCH) WRITE(NPRNT,1004)
 1004    FORMAT(' PLEASE ENTER ',
     1         /'  1 IF THE ATTRIBUTE IS AN INTEGER',
     2         /'  2 IF THE ATTRIBUTE IS A REAL NUMBER',
     3         /'  3 IF THE ATTRIBUTE IS A CHARACTER STRING '\)
                  CALL READIN(ICARD,LENICD,ISTART,ISTOP)
                  if(icard(1).ge.49.and.icard(1).le.51)then
                   CALL INUM(ICARD,ACTION,ISTART)
                     else
                   write(*,*)' Enter a 1 a 2 or a 3  - Again Please'
                   go to 1002
                  endif
CC
                  RECORD( 84 ) = ACTION
                  RECORD( 85 ) = ACTION
CC
                  IF( ACTION .LT. 3 ) GO TO 100
CC
       IF(.NOT.BATCH) WRITE(NPRNT,1005)
 1005    FORMAT(' TYPE IN THE MAXIMUM NUMBER OF CHARACTERS IN THE ',
     1         'CHARACTER STRING'\)
                    CALL READIN(ICARD,LENICD,ISTART,ISTOP)
                    CALL INUM(ICARD,RECORD(85),ISTART)
100               CONTINUE
CC
CCALCULATING THE NUMBER OF RECORDS NEEDED TO STORE THE POLYGON ATTRIBUTE
CC VALUES
CC
                  NUMBER = 128 / RECORD( 85 )
                  RECORD( 87 ) = POLYGON / NUMBER
                IF(RECORD(87)*NUMBER.NE.POLYGON)RECORD(87)=RECORD(87)+1
                  LOCATE = RECORD( 1 ) + 1
                  CALL WRBLK( CHANEL, LOCATE, RECORD, 1, IER )
CC
CC CREATING THE POLYGON ATTRIBUTE SET RECORDS.
CC
                  IF( ACTION .EQ. 1 ) CALL DIGET
                  IF( ACTION .EQ. 2 ) CALL REALS
                  IF( ACTION .EQ. 3 ) CALL LETERS( RECORD( 85 ) )
                  IF(BATCH) REWIND ICHAN7
CC
                  IF(.NOT.BATCH) WRITE(NPRNT,1003)
 1003  FORMAT(' PLEASE ENTER DESIRED OPTION:',
     1      //'    1  TO CONTINUE ADDING ATTRIBUTES ',
     2      //'    2  TO RETURN TO MAIN MENU'\)
                  CALL READIN(ICARD,LENICD,ISTART,ISTOP)
                  CALL INUM(ICARD,ACTION,ISTART)
                  IF( ACTION .EQ. 1 ) GO TO 20
CC
CC
CC UPDATE THE ASSOCIATED ATTRIBUTES DATA BASE HEADER.
CC
                  RECORD( 1 ) = ATRBTE
                  RECORD( 2 ) = POLYGON
                  CALL WRBLK( CHANEL, 1, RECORD, 1, IER )
                  IF(BATCH)  CLOSE(ICHAN8,IOSTAT=IER)
                  IF(BATCH)  CLOSE(ICHAN7,IOSTAT=IER)
                  ioin=iohold
                  RETURN
CC
C  ERRORS
C
 900  WRITE(NPRNT,3000)
 3000 FORMAT(' COULD NOT OPEN THE ATTRIBUTES INPUT DATA FILE')
      RETURN
 910  CLOSE(ICHAN7,IOSTAT=IER)
      WRITE(NPRNT,3010)
 3010 FORMAT(' COULD NOT OPEN THE ATTRIBUTES DEFINTION FILE ')
      RETURN
C
                END
